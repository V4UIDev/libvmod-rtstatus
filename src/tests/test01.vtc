varnishtest "Test rtstatus() can be just used in vcl_synth"

server s1 {
        rxreq
        txresp
} -start

varnish v1 -arg "-i ${tmpdir}/v1" -vcl+backend {
	import rtstatus from "${vmod_topbuild}/src/.libs/libvmod_rtstatus.so";

	sub vcl_deliver {
		rtstatus.synthetic_json();
		return (deliver);
	}
} -start

logexpect l1 -v v1 -g raw {
	expect * = Error "rtstatus: can only be used in vcl_synth"
}

client c1 {
        txreq -url "/rtstatus.json"
        rxresp
        expect resp.status == 503
} -run
